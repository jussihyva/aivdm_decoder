{%extends "layout.html" %}

{% block content %}
<script>
	let filterTime = 900
	$(document).ready(function()
	{
		setInterval(function() {update_page();}, 10000);
		$("#add_mmsi_mid").click(function() {$('#ui_modal').modal('show');});
		$("#save").click(function(){
			let mmsi_mid = $("#mmsi_mid").val();
			let mmsi_mid_list = mmsi_mid.split("\n");
			for (var i = 0; i < mmsi_mid_list.length;  ++i)
			{
				$.ajax(
				{
					url: "/country",
					type: "POST",
					contentType: "application/json",
					data:  JSON.stringify({"symbol": mmsi_mid_list[i]}),
					dataType: "json"
				})
			}
			$('#ui_modal').modal('dispose');
		});
	});
	function filterPeriod()
	{
		filterTime = document.getElementById("time_period").value;
	}
	function update_page()
	{
		$.ajax(
			{
				url: "/table",
				type: "GET",
				data:  {"timestamp": parseInt((Date.now() / 1000) - filterTime, 10)},
				success: function(data, status)
				{
					document.getElementById("country_table").innerHTML = data
				}
			})
	}
</script>
<div class="ui form">
	<label>Select time period:</label>
	<select id="time_period" size="1" onchange="filterPeriod()">
		<option value="900">Last 15 min</option>
		<option value="3600">Last hour</option>
		<option value="86400">Last day</option>
		<option value="604800">Last week</option>
	  </select>
</div>
<div id="country_table">
	{% include "table.html" %}
</div>
{% endblock %}
